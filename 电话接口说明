接口说明

使用webSocket通讯协议和HTTP API接口。

要求浏览器支持h5。

webSocket 地址：39.97.233.183

webSocket 端口：4444



| 模块           | 方法        | 事件    | 发送                                                         | 说明               | 返回                                                         |
| -------------- | ----------- | ------- | ------------------------------------------------------------ | ------------------ | ------------------------------------------------------------ |
| 登录           | Login       | ws.send | {"MSG":"Login","Data":{"extension":"1001","AgentId":"1001","eq":"话机"}} | eq ["话机","手机"] | {"Response":"Login","success":"true","message":"登录成功"}   |
| 切换状态[空闲] | AgentChange | ws.snd  | {"MSG":"AgentChange","Data":{"AgentId":"1001","State":"Available"}} |                    | {"Response":"AgentChange","success":"true","message":"+OK\n","status":"Available"} |
| 切换状态[小休] | AgentChange | ws.sed  | {"MSG":"AgentChange","Data":{"AgentId":"1001","State":"On Break"}} |                    | {"Response":"AgentChange","success":"true","message":"+OK\n","status":"On Break"} |
| 呼叫电话       | MakeCall    | ws.send | {"MSG":"MakeCall","Data":{"extension":"1001","CalledNumber":"1002"}} |                    | {"Response":"MakeCall","success":"true","message":"+OK 384efbde-caca-441b-84c5-fd207e0776d4\n","CallId":"384efbde-caca-441b-84c5-fd207e0776d4"} |
| 保持           | HoldCall    | ws.send | {"MSG":"HoldCall","Data":{"CallId":"df2e1b85-32ff-40e7-9ce4-eee55cdf1f65"}} |                    | {"Response":"HoldCall","success":"true","message":"+OK Success\n"} |
| 取消保持       | UnHoldCall  | ws.send | {"MSG":"UnHoldCall","Data":{"CallId":"8664a668-5601-4e6e-834c-4e8019f45515"}} |                    | {"Response":"UnHoldCall","success":"true","message":"+OK Success\n"} |
| 挂机           |             | ws.send | {"MSG":"HangupCall","Data":{"CallId":"8664a668-5601-4e6e-834c-4e8019f45515"}} |                    | {"MSG":"HangupCall","Data":{"CallId":"8664a668-5601-4e6e-834c-4e8019f45515"}} |



| 事件     | 返回                                                         |
| -------- | ------------------------------------------------------------ |
| 心跳     | {"Response":"MakeCall","success":"true","message":"+OK 384efbde-caca-441b-84c5-fd207e0776d4\n","CallId":"384efbde-caca-441b-84c5-fd207e0776d4"} |
| 挂机     | {"ChannelState":"CS_REPORTING","StateName":"未知..>CS_REPORTING","HangupCause":{"HangupCauseCode":3,"HangupCauseSipCode":"404","HangupCauseName":"NO_ROUTE_DESTINATION","HangupCauseCause":"没有通往目的地的路线[Q.850]","HangupCauseDes":"此原因表明，由于路由呼叫所经过的网络无法满足所需的目的地，因此无法接通被叫方。基于网络支持此原因。"},"ChannelReadCodecName":"PCMU","ChannelReadCodecRate":"8000","ChannelWriteCodecName":"PCMU","ChannelWriteCodecRate":"8000","CallerUsername":null,"CallerDialplan":"XML","CallerCallerIDName":"Outbound Call","CallerCallerIDNumber":"1001","CallerNetworkAddr":"121.69.4.125","CallerDestinationNumber":"1002","CallerUniqueID":"384efbde-caca-441b-84c5-fd207e0776d4","CallerSource":"src/switch_ivr_originate.c","CallerContext":"default","CallerChannelName":"sofia/internal/1001@121.69.4.125:9865","CallerScreenBit":"true","CallerPrivacyHideName":"false","CallerPrivacyHideNumber":"false","EventName":"CHANNEL_HANGUP_COMPLETE","CoreUUID":"1f6175e0-d4c9-428e-8fdd-f4a503ae8994","FreeSWITCHHostname":"test01","FreeSWITCHIPv4":"172.26.5.146","FreeSWITCHIPv6":"::1","EventDateLocal":"2021-02-24 22:32:27","EventDateGMT":"Wed, 24 Feb 2021 14:32:27 GMT","EventDateTimestamp":"1614177147807459","EventCallingFile":"switch_core_state_machine.c","EventCallingFunction":"switch_core_session_reporting_state","EventCallingLineNumber":"947","ChannelStateNumber":"11","ChannelName":"sofia/internal/1001@121.69.4.125:9865","UniqueID":"384efbde-caca-441b-84c5-fd207e0776d4","CallDirection":"outbound","PresenceCallDirection":"outbound","AnswerState":"hangup","CallerProfileIndex":"2","CallerProfileCreatedTime":"1614177147767470","CallerChannelCreatedTime":"1614177143987457","CallerChannelAnsweredTime":"1614177147747464","CallerChannelProgressTime":"1614177144007458","CallerChannelProgressMediaTime":"0","CallerChannelHangupTime":"1614177147807459","CallerChannelTransferTime":"0","variable_sip_received_ip":null,"variable_sip_received_port":null,"variable_sip_via_protocol":null,"variable_sip_authorized":null,"variable_sip_number_alias":null,"variable_sip_auth_username":null,"variable_sip_auth_realm":null,"variable_number_alias":null,"variable_user_name":null,"variable_domain_name":null,"variable_toll_allow":"domestic,international,local","variable_accountcode":"1001","variable_user_context":"default","variable_effective_caller_id_name":"1001","variable_effective_caller_id_number":"1001","variable_outbound_caller_id_name":"1001","variable_outbound_caller_id_number":"1001","variable_callgroup":"客服","variable_record_stereo":null,"variable_default_gateway":null,"variable_default_areacode":null,"variable_transfer_fallback_extension":null,"variable_sip_from_params":null,"variable_sip_from_uri":"0000000000@172.26.5.146","variable_sip_from_host":"172.26.5.146","variable_sip_from_user_stripped":null,"variable_sip_from_tag":"j9Q11K4H9FDeQ","variable_sofia_profile_name":"internal","variable_sip_req_params":null,"variable_sip_req_user":null,"variable_sip_req_uri":"1001@121.69.4.125:9865","variable_sip_req_host":null,"variable_sip_to_params":null,"variable_sip_to_user":"1001","variable_sip_to_uri":"1001@121.69.4.125:9865","variable_sip_to_host":"121.69.4.125","variable_sip_contact_params":null,"variable_sip_contact_user":"1001","variable_sip_contact_port":"9865","variable_sip_contact_uri":"1001@121.69.4.125:9865","variable_sip_contact_host":"121.69.4.125","variable_channel_name":"sofia/internal/1001@121.69.4.125:9865","variable_sip_call_id":"f398670f-f14f-1239-bd8d-00163e101cdb","variable_sip_via_host":null,"variable_sip_via_port":null,"variable_sip_via_rport":null,"variable_max_forwards":"70","variable_switch_r_sdp":"v=0\r\no=- 132886332 132886340 IN IP4 121.69.4.125\r\ns=eyeBeam\r\nc=IN IP4 121.69.4.125\r\nt=0 0\r\nm=audio 7460 RTP/AVP 0 8 101\r\na=rtpmap:101 telephone-event/8000\r\na=fmtp:101 0-15\r\na=alt:1 1 : 57A9B986 1B714EA3 192.168.101.166 7460\r\n","variable_presence_id":"1001@172.26.5.146","variable_remote_media_ip":"121.69.4.125","variable_remote_media_port":"7460","variable_write_codec":"PCMU","variable_write_rate":"8000","variable_local_media_ip":"172.26.5.146","variable_local_media_port":"32372","variable_endpoint_disposition":"ANSWER","variable_current_application_data":"1002","variable_current_application":"transfer","variable_conference_name":null,"variable_sip_term_status":null,"variable_sip_term_cause":null,"variable_sip_user_agent":null,"variable_sip_hangup_disposition":"send_bye","variable_read_codec":"PCMU","variable_read_rate":"8000","variable_hangup_cause":"NO_ROUTE_DESTINATION","variable_hangup_cause_q850":"3","variable_digits_dialed":"none","variable_start_stamp":"2021-02-24 22:32:23","variable_profile_start_stamp":"2021-02-24 22:32:27","variable_answer_stamp":"2021-02-24 22:32:27","variable_end_stamp":"2021-02-24 22:32:27","variable_start_epoch":"1614177143","variable_start_uepoch":"1614177143987457","variable_profile_start_epoch":"1614177147","variable_profile_start_uepoch":"1614177147767470","variable_answer_epoch":"1614177147","variable_answer_uepoch":"1614177147747464","variable_progress_epoch":"1614177144","variable_progress_uepoch":"1614177144007458","viable_progress_media_epoch":"0","variable_progress_media_uepoch":"0","variable_end_epoch":"1614177147","variable_end_uepoch":"1614177147807459","variable_last_app":"transfer","variable_last_arg":"1002","variable_caller_id":"\"Outbound Call\" <1001>","variable_duration":"4","variable_billsec":"0","variable_progresssec":"1","variable_answersec":"4","variable_progress_mediasec":"0","variable_flow_billsec":"4","variable_mduration":"3820","variable_billmsec":"60","variable_progressmsec":"20","variable_answermsec":"3760","variable_progress_mediamsec":"0","variable_flow_billmsec":"3820","variable_uduration":"3820002","variable_billusec":"59995","variable_progressusec":"20001","variable_answerusec":"3760007","variable_progress_mediausec":"0","variable_flow_billusec":"3820002","variable_rtp_audio_in_raw_bytes":"0","variable_rtp_audio_in_media_bytes":"0","variable_rtp_audio_in_packet_count":"0","variable_rtp_audio_in_media_packet_count":"0","variable_rtp_audio_in_skip_packet_count":"0","variable_rtp_audio_in_jb_packet_count":null,"variable_rtp_audio_in_dtmf_packet_count":"0","variable_rtp_audio_in_cng_packet_count":"0","variable_rtp_audio_in_flush_packet_count":"0","variable_rtp_audio_out_raw_bytes":"0","variable_rtp_audio_out_media_bytes":"0","variable_rtp_audio_out_packet_count":"0","variable_rtp_audio_out_media_packet_count":"0","variable_rtp_audio_out_skip_packet_count":"0","variable_rtp_audio_out_dtmf_packet_count":"0","variable_rtp_audio_out_cng_packet_count":"0","Response":"EVENT"} |
| 直呼分机 | {"ChannelState":"CS_EXECUTE","StateName":"CS_EXECUTE-频道正在执行它的拨号计划","EventName":"CHANNEL_CALLSTATE","CoreUUID":"6587b717-7f55-44af-9399-6e54abfa3e3f","FreeSWITCHHostname":"test01","FreeSWITCHIPv4":"172.26.5.146","FreeSWITCHIPv6":"::1","EventDateLocal":"2021-02-24 22:50:03","EventDateGMT":"Wed, 24 Feb 2021 14:50:03 GMT","EventDateTimestamp":"1614178203886382","EventCallingFile":"switch_channel.c","EventCallingFunction":"switch_channel_perform_set_callstate","EventCallingLineNumber":"295","OriginalChannelCallState":"RINGING","ChannelCallState":"EARLY","ChannelStateNumber":"4","ChannelName":"sofia/internal/1002@39.97.233.183","UniqueID":"57afb084-de6a-4530-a50c-3908f533be43","CallDirection":"inbound","PresenceCallDirection":"inbound","ChannelPresenceID":"1002@39.97.233.183","AnswerState":"early","ChannelReadCodecName":"PCMA","ChannelReadCodecRate":"8000","ChannelReadCodecBitRate":"64000","ChannelWriteCodecName":"PCMA","ChannelWriteCodecRate":"8000","ChannelWriteCodecBitRate":"64000","CallerDirection":"inbound","CallerUsername":"1002","CallerDialplan":"XML","CallerCallerIDName":"1002","CallerCallerIDNumber":"1002","CallerNetworkAddr":"121.69.4.125","CallerANI":"1002","CallerDestinationNumber":"1001","CallerUniqueID":"57afb084-de6a-4530-a50c-3908f533be43","CallerSource":"mod_sofia","CallerContext":"default","CallerChannelName":"sofia/internal/1002@39.97.233.183","CallerProfileIndex":"1","CallerProfileCreatedTime":"1614178203766400","CallerChannelCreatedTime":"1614178203766400","CallerChannelAnsweredTime":"0","CallerChannelProgressTime":"1614178203846380","CallerChannelProgressMediaTime":"1614178203886382","CallerChannelHangupTime":"0","CallerChannelTransferTime":"0","CallerScreenBit":"true","CallerPrivacyHideName":"false","CallerPrivacyHideNumber":"false","Response":"EVENT"} |
| 应答     | {"ChannelStateName":"CS_CONSUME_MEDIA-频道正在消耗所有媒体并丢弃它","AnswerState":"answered","CallDirection":"outbound","CallerANI":"1002","CallerCalleeIDName":"Outbound Call","CallerCalleeIDNumber":"1001","CallerPrivacyHideName":"false","CallerCallerIDNumber":"1002","CallerChannelAnsweredTime":"1614178214746384","CallerChannelBridgedTime":"0","CallerChannelCreatedTime":"1614178203826384","CallerChannelHangupTime":"0","CallerChannelHoldAccum":"0","CallerChannelLastHold":"0","CallerChannelName":"sofia/internal/1001@121.69.4.125:9860","CallerChannelProgressMediaTime":"0","CallerChannelProgressTime":"1614178203846380","CallerChannelResurrectTime":"0","CallerChannelTransferTime":"0","CallerContext":"default","CallerDestinationNumber":"1001","CallerDialplan":"XML","CallerDirection":"outbound","CallerNetworkAddr":null,"CallerCallerIDName":"Extension 1002","CallerPrivacyHideNumber":"false","CallerProfileCreatedTime":"1614178203826384","CallerProfileIndex":"1","CallerScreenBit":"true","CallerSource":"mod_sofia","CallerUniqueID":"df2e1b85-32ff-40e7-9ce4-eee55cdf1f65","CallerUsername":"1002","ChannelCallState":"RINGING","ChannelCallUUID":"57afb084-de6a-4530-a50c-3908f533be43","ChannelHITDialplan":"false","ChannelName":"sofia/internal/1001@121.69.4.125:9860","ChannelPresenceID":"1001@172.26.5.146","ChannelReadCodecBitRate":"64000","ChannelReadCodecName":"PCMA","ChannelReadCodecRate":"8000","ChannelState":"CS_CONSUME_MEDIA","ChannelStateNumber":"7","ChannelWriteCodecBitRate":"64000","ChannelWriteCodecName":"PCMA","ChannelWriteCodecRate":"8000","CoreUUID":"6587b717-7f55-44af-9399-6e54abfa3e3f","EventCallingFile":"switch_channel.c","EventCallingFunction":"switch_channel_perform_mark_answered","EventCallingLineNumber":"3801","EventDateGMT":"Wed, 24 Feb 2021 14:50:14 GMT","EventDateLocal":"2021-02-24 22:50:14","EventDateTimestamp":"1614178214746384","EventName":"CHANNEL_ANSWER","EventSequence":"781","FreeSWITCHHostname":"test01","FreeSWITCHIPv4":"172.26.5.146","FreeSWITCHIPv6":"::1","FreeSWITCHSwitchname":"test01","OtherLegANI":"1002","OtherLegCallerIDName":"1002","OtherLegCallerIDNumber":"1002","OtherLegChannelAnsweredTime":"0","OtherLegChannelBridgedTime":"0","OtherLegChannelCreatedTime":"0","OtherLegChannelHangupTime":"0","OtherLegChannelHoldAccum":"0","OtherLegChannelLastHold":"0","OtherLegChannelName":"sofia/internal/1002@39.97.233.183","OtherLegChannelProgressMediaTime":"0","OtherLegChannelProgressTime":"1614178203846380","OtherLegChannelResurrectTime":"0","OtherLegChannelTransferTime":"0","OtherLegContext":"default","OtherLegDestinationNumber":"1001","OtherLegDialplan":"XML","OtherLegDirection":"inbound","OtherLegNetworkAddr":"121.69.4.125","OtherLegPrivacyHideName":"false","OtherLegPrivacyHideNumber":"false","OtherLegProfileCreatedTime":"0","OtherLegScreenBit":"true","OtherLegSource":"mod_sofia","OtherLegUniqueID":"57afb084-de6a-4530-a50c-3908f533be43","OtherLegUsername":"1002","OtherType":"originator","PresenceCallDirection":"outbound","UniqueID":"df2e1b85-32ff-40e7-9ce4-eee55cdf1f65","variable_RFC2822_DATE":null,"variable_absolute_codec_string":null,"variable_advertised_media_ip":"39.97.233.183","variable_call_uuid":"57afb084-de6a-4530-a50c-3908f533be43","variable_channel_name":"sofia/internal/1001@121.69.4.125:9860","variable_dialed_domain":"172.26.5.146","variable_dialed_extension":"1001","variable_dialed_user":"1001","variable_direction":"outbound","variable_dtmf_type":"rfc2833","variable_ep_codec_string":"CORE_PCM_MODULE.PCMU@8000h@20i@64000b,CORE_PCM_MODULE.PCMA@8000h@20i@64000b","variable_export_vars":"dialed_extension","variable_is_outbound":"true","variable_local_media_ip":"172.26.5.146","variable_local_media_port":"26238","variable_max_forwards":"69","variable_originate_early_media":"true","variable_originating_leg_uuid":"57afb084-de6a-4530-a50c-3908f533be43","variable_originator":"57afb084-de6a-4530-a50c-3908f533be43","variable_originator_codec":"CORE_PCM_MODULE.PCMA@8000h@20i@64000b,CORE_PCM_MODULE.PCMU@8000h@20i@64000b","variable_presence_id":"1001@172.26.5.146","variable_read_codec":"PCMA","variable_read_rate":"8000","variable_recovery_profile_name":"internal","variable_remote_media_ip":"121.69.4.125","variable_remote_media_port":"7460","variable_rtp_use_ssrc":"1882822995","variable_session_id":"4","variable_signal_bond":"57afb084-de6a-4530-a50c-3908f533be43","variable_sip_audio_recv_pt":null,"variable_sip_call_id":"6b50fc19-f152-1239-40b8-00163e101cdb","variable_sip_contact_host":"121.69.4.125","variable_sip_contact_port":"9860","variable_sip_contact_uri":"1001@121.69.4.125:9860","variable_sip_contact_user":"1001","variable_sip_cseq":"32535309","variable_sip_destination_url":"sip:1001@121.69.4.125:9860","variable_sip_from_display":"Extension 1002","variable_sip_from_host":"172.26.5.146","variable_sip_from_tag":"XUgrSN67ye4vK","variable_sip_from_uri":"1002@172.26.5.146","variable_sip_from_user":"1002","variable_sip_full_from":"\"Extension 1002\" <sip:1002@172.26.5.146>;tag=XUgrSN67ye4vK","variable_sip_full_to":"<sip:1001@121.69.4.125:9860>;tag=0e271a44","variable_sip_full_via":"SIP/2.0/UDP 39.97.233.183;rport=5060;branch=z9hG4bKg6Hejy210p5De;received=39.97.233.183","variable_sip_invite_domain":"172.26.5.146","variable_sip_local_network_addr":"39.97.233.183","variable_sip_local_sdp_str":null,"variable_sip_network_ip":"121.69.4.125","variable_sip_network_port":"9860","variable_sip_outgoing_contact_uri":"<sip:mod_sofia@39.97.233.183:5060>","variable_sip_profile_name":"internal","variable_sip_recover_contact":"<sip:1001@121.69.4.125:9860>","variable_sip_recover_via":"SIP/2.0/UDP 39.97.233.183;rport=5060;branch=z9hG4bKg6Hejy210p5De;received=39.97.233.183","variable_sip_reply_host":"121.69.4.125","variable_sip_reply_port":"9860","variable_sip_req_uri":"1001@121.69.4.125:9860","variable_sip_to_host":"121.69.4.125","variable_sip_to_tag":"0e271a44","variable_sip_to_uri":"1001@121.69.4.125:9860","variable_sip_to_user":"1001","variable_sip_use_codec_name":null,"variable_sip_use_codec_ptime":null,"variable_sip_use_codec_rate":null,"variable_sip_use_pt":null,"variable_sofia_profile_name":"internal","variable_switch_m_sdp":"v=0\r\no=- 3823195802 3823195802 IN IP4 121.69.4.125\r\ns=pjmedia\r\nb=AS:84\r\nt=0 0\r\na=X-nat:0\r\nm=audio 4002 RTP/AVP 8 0 101\r\nc=IN IP4 121.69.4.125\r\nb=TIAS:64000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:101 telephone-event/8000\r\na=fmtp:101 0-16\r\na=rtcp:4003 IN IP4 192.168.101.166\r\na=ssrc:456744742 cname:5311441d748e1b6e\r\n","variable_switch_r_sdp":"v=0\r\no=- 133946179 133946186 IN IP4 121.69.4.125\r\ns=eyeBeam\r\nc=IN IP4 121.69.4.125\r\nt=0 0\r\nm=audio 7460 RTP/AVP 8 0 101\r\na=rtpmap:101 telephone-event/8000\r\na=fmtp:101 0-15\r\na=alt:1 1 : C0DCFD52 4A0549C8 192.168.101.166 7460\r\n","variable_uuid":"df2e1b85-32ff-40e7-9ce4-eee55cdf1f65","variable_write_codec":"PCMA","variable_write_rate":"8000","Response":"EVENT"} |



HTTP 接口

| 事件     | 接口地址                                                     | 参数说                                                       |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 查询坐席 | http://39.97.233.183:3333/callcenter/GetAvailableUser?AgentId=1001 | AgentId::分机号                                              |
| 满意度   | http://39.97.233.183:3333/bgapi/fs/fs_transfer_satis?uuid=70e366ec-f791-4c9c-86b4-8b6de1a39666&FileName=Satis.lua&AgentId=1001&CallDirection=in | uuid::呼叫id 。FileName::Satis.lua。写死。AgentId::分机号。CallDirection::呼叫方向【in 呼入 out呼出】 |
| 盲转     | http://39.97.233.183:3333//mod/Blind_turn?uuid=${TranCallId}&phone=${TranAni} | uuid::转接id。 phone ::被转号码                              |

